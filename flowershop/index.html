<!DOCTYPE html>
<html>
<head>
    <title></title>
	<meta charset="utf-8" />
	<!--<script src="cordova.js"></script>-->
	<script src="kendo/js/jquery.min.js"></script>
	<script src="kendo/js/kendo.mobile.min.js"></script>
	<script src="scripts/jaydata.js" type="text/javascript"></script>
	<script src="scripts/jaydatamodules/kendo.js" type="text/javascript"></script>
    <script src="scripts/mydatabase.js" type="text/javascript"></script>
	<link href="kendo/styles/kendo.mobile.all.min.css" rel="stylesheet" />
	<link href="styles/main.css" rel="stylesheet" />
    <style scoped>
        /*
        #forms input:not([type=checkbox]):not([type=radio]),
        #forms select,
        #forms .k-dropdown
        {
            -webkit-box-sizing: border-box;
            box-sizing: border-box;
            width: 50%;
        }*/
    </style>
</head>
<body>

    <div data-role="view" id="list" data-model="viewModel" data-transition="slide" data-title="Surveys">
        <header data-role="header">
            <div data-role="navbar">
                <a data-align="right" data-icon="add" data-role="button" href="#editor" data-bind="click: newSurvey">New</a>
            </div>
        </header>
        <ul id="listView"
            data-role="listview"
            data-style="inset"
            data-template="item-template"
            data-bind="source: surveyDataSource, events: { click: select }">
        </ul>
    </div>
    
	<script id="item-template" type="text/x-kendo-template">
        <a href="##details" data-bind="text:Name"></a>
	</script>

    <div data-role="view" id="details" data-model="viewModel" data-transition="slide" data-title="Show survey">
        <header data-role="header">
            <div data-role="navbar">
                <a data-align="left" data-role="backbutton">Back</a>
                <a data-align="right" data-role="button" href="#list" data-bind="click: remove">Delete</a>
                <a data-align="right" data-role="button" href="#editor">Edit</a>
            </div>
        </header>
        <ul data-role="listview" data-style="inset">
            <li>ID<span class="value" data-bind="text: survey.id"></span></li>
            <li>Name <span class="value" data-bind="text: survey.Name"></span></li>
            <li>Age <span class="value" data-bind="text: survey.AgeGroup"></span></li>
            <li>Reason <span class="value" data-bind="text: survey.Reason"></span></li>
            <li>Trip days<span class="value" data-bind="text: survey.TripDays"></span></li>
            <li>Stays in hotel<span class="value" data-bind="text: survey.StaysInHotel"></span></li>
        </ul>
    </div>
    
    <div data-role="view" id="editor" data-model="viewModel" data-transition="slide" data-title="New survey">
        <header data-role="header">
            <div data-role="navbar">
                <a data-align="left" data-role="backbutton" >Back</a>
                <a data-align="right" data-role="button" href="#list" data-bind="click: add, visible: survey.isNew, enabled: hasChanges">Add</a>
                <a data-align="right" data-role="button" href="#list" data-bind="click: remove, invisible: survey.isNew">Delete</a>
                <a data-align="right" data-role="button" href="#list" data-bind="click: save, invisible: survey.isNew, enabled: hasChanges">Save</a>
            </div>
        </header>
        
        <form id="surveyForm">
            <ul data-role="listview" data-style="inset">
                <li>Your Name<input  data-bind="value: survey.Name" required type="text" /></li>
                <li>Your Age <select data-bind="source: AgeGroupOptions, value: survey.AgeGroup"></select></li>
                <li>Reason of travel<select data-bind="source: ReasonOptions, value: survey.Reason"></select></li>
                <li>Stays in hotel<input type="checkbox" data-role="switch" data-bind="checked: survey.StaysInHotel" ></li>
                <li>Travel days<input type="number" data-bind="value: survey.TripDays" /></li>
            </ul>
        </form>
    </div>
    <script>
        var tripDB = new TripDB({name: 'local', databaseName: 'tripdbx'});
        alert(tripDB);
        
        $.when(tripDB.onReady()).then(
            function () {
            var surveyDataSource = tripDB.TripAnswers.asKendoDataSource();
                
            viewModel = kendo.observable({
                surveyDataSource: surveyDataSource,
                AgeGroupOptions: [ "", "under 18", "18-27", "28-44", "45-62", "Over 63"],
                ReasonOptions: ["",  "Vacation", "Business", "Family/friend visit","Other"],
                
                survey:  null,
                
                add: function() {
                    surveyDataSource.add( viewModel.survey );
                    surveyDataSource.sync();
                },
                
                save: function() {
                    surveyDataSource.sync();
                },
                
                newSurvey: function(e) {
                    viewModel.set('survey',new surveyDataSource.options.schema.model());
                },
                
                remove: function(e) {
                    surveyDataSource.remove(viewModel.survey);
                    surveyDataSource.sync();
                },
                
                select: function(e) {
                    viewModel.set('survey',null);
                    viewModel.set('survey', e.dataItem);
                }
            });

            app = new kendo.mobile.Application(document.body);
        });
    </script>
</body>
</html>
